/*
 * Â© 2025 Platform Engineering Labs Inc.
 *
 * SPDX-License-Identifier: FSL-1.1-ALv2
 */

module aws.sagemaker.userprofile

import "@formae/formae.pkl"
import "../aws.pkl"

const type = "AWS::SageMaker::UserProfile"

typealias RStudioServerProAppSettingsAccessStatus = "ENABLED"|"DISABLED"
typealias RStudioServerProAppSettingsUserGroup = "R_STUDIO_ADMIN"|"R_STUDIO_USER"
typealias ResourceSpecInstanceType = "system"|"ml.t3.micro"|"ml.t3.small"|"ml.t3.medium"|"ml.t3.large"|"ml.t3.xlarge"|"ml.t3.2xlarge"|"ml.m5.large"|"ml.m5.xlarge"|"ml.m5.2xlarge"|"ml.m5.4xlarge"|"ml.m5.8xlarge"|"ml.m5.12xlarge"|"ml.m5.16xlarge"|"ml.m5.24xlarge"|"ml.c5.large"|"ml.c5.xlarge"|"ml.c5.2xlarge"|"ml.c5.4xlarge"|"ml.c5.9xlarge"|"ml.c5.12xlarge"|"ml.c5.18xlarge"|"ml.c5.24xlarge"|"ml.p3.2xlarge"|"ml.p3.8xlarge"|"ml.p3.16xlarge"|"ml.g4dn.xlarge"|"ml.g4dn.2xlarge"|"ml.g4dn.4xlarge"|"ml.g4dn.8xlarge"|"ml.g4dn.12xlarge"|"ml.g4dn.16xlarge"|"ml.r5.large"|"ml.r5.xlarge"|"ml.r5.2xlarge"|"ml.r5.4xlarge"|"ml.r5.8xlarge"|"ml.r5.12xlarge"|"ml.r5.16xlarge"|"ml.r5.24xlarge"|"ml.p3dn.24xlarge"|"ml.m5d.large"|"ml.m5d.xlarge"|"ml.m5d.2xlarge"|"ml.m5d.4xlarge"|"ml.m5d.8xlarge"|"ml.m5d.12xlarge"|"ml.m5d.16xlarge"|"ml.m5d.24xlarge"|"ml.g5.xlarge"|"ml.g5.2xlarge"|"ml.g5.4xlarge"|"ml.g5.8xlarge"|"ml.g5.12xlarge"|"ml.g5.16xlarge"|"ml.g5.24xlarge"|"ml.g5.48xlarge"|"ml.p4d.24xlarge"|"ml.p4de.24xlarge"|"ml.geospatial.interactive"|"ml.trn1.2xlarge"|"ml.trn1.32xlarge"|"ml.trn1n.32xlarge"
typealias SharingSettingsNotebookOutputOption = "Allowed"|"Disabled"
typealias UserSettingsStudioWebPortal = "ENABLED"|"DISABLED"
typealias AutoMountHomeEFS = "Enabled"|"Disabled"


@aws.SubResourceHint
open class AppLifecycleManagement extends formae.SubResource {
    idleSettings: IdleSettings?
}

@aws.SubResourceHint
open class CodeEditorAppSettings extends formae.SubResource {
    appLifecycleManagement: AppLifecycleManagement?
    customImages: Listing<CustomImage>?
    defaultResourceSpec: ResourceSpec?
    lifecycleConfigArns: Listing<String|formae.Resolvable>?
}

@aws.SubResourceHint
open class CodeRepository extends formae.SubResource {
    repositoryUrl: String(matches(Regex(#"^https://([.\-_a-zA-Z0-9]+/?){3,1016}$"#)))
}

@aws.SubResourceHint
open class CustomFileSystemConfig extends formae.SubResource {
    efsFileSystemConfig: EFSFileSystemConfig?
    fSxLustreFileSystemConfig: FSxLustreFileSystemConfig?
}

@aws.SubResourceHint
open class CustomImage extends formae.SubResource {
    appImageConfigName: String(matches(Regex(#"^[a-zA-Z0-9](-*[a-zA-Z0-9]){0,62}"#)))
    imageName: String(matches(Regex(#"^[a-zA-Z0-9]([-.]?[a-zA-Z0-9]){0,62}$"#)))
    imageVersionNumber: Int?
}

@aws.SubResourceHint
open class CustomPosixUserConfig extends formae.SubResource {
    gid: Int
    uid: Int
}

@aws.SubResourceHint
open class DefaultEbsStorageSettings extends formae.SubResource {
    defaultEbsVolumeSizeInGb: Int
    maximumEbsVolumeSizeInGb: Int
}

@aws.SubResourceHint
open class DefaultSpaceStorageSettings extends formae.SubResource {
    defaultEbsStorageSettings: DefaultEbsStorageSettings?
}

@aws.SubResourceHint
open class EFSFileSystemConfig extends formae.SubResource {
    fileSystemId: String(matches(Regex(#"^(fs-[0-9a-f]{8,})$"#)))|formae.Resolvable
    fileSystemPath: String(matches(Regex(#"^\/\S*$"#)))?
}

@aws.SubResourceHint
open class FSxLustreFileSystemConfig extends formae.SubResource {
    fileSystemId: String(matches(Regex(#"^(fs-[0-9a-f]{8,})$"#)))|formae.Resolvable
    fileSystemPath: String(matches(Regex(#"^\/\S*$"#)))?
}

@aws.SubResourceHint
open class IdleSettings extends formae.SubResource {
    idleTimeoutInMinutes: Int?
    lifecycleManagement: String?
    maxIdleTimeoutInMinutes: Int?
    minIdleTimeoutInMinutes: Int?
}

@aws.SubResourceHint
open class JupyterLabAppSettings extends formae.SubResource {
    appLifecycleManagement: AppLifecycleManagement?
    codeRepositories: Listing<CodeRepository>?
    customImages: Listing<CustomImage>?
    defaultResourceSpec: ResourceSpec?
    lifecycleConfigArns: Listing<String|formae.Resolvable>?
}

@aws.SubResourceHint
open class JupyterServerAppSettings extends formae.SubResource {
    defaultResourceSpec: ResourceSpec?
    lifecycleConfigArns: Listing<String|formae.Resolvable>?
}

@aws.SubResourceHint
open class KernelGatewayAppSettings extends formae.SubResource {
    customImages: Listing<CustomImage>?
    defaultResourceSpec: ResourceSpec?
    lifecycleConfigArns: Listing<String|formae.Resolvable>?
}

@aws.SubResourceHint
open class RStudioServerProAppSettings extends formae.SubResource {
    accessStatus: RStudioServerProAppSettingsAccessStatus?
    userGroup: RStudioServerProAppSettingsUserGroup?
}

@aws.SubResourceHint
open class ResourceSpec extends formae.SubResource {
    instanceType: ResourceSpecInstanceType?
    lifecycleConfigArn: (String(matches(Regex(#"arn:aws[a-z\-]*:sagemaker:[a-z0-9\-]*:[0-9]{12}:studio-lifecycle-config/.*"#)))|formae.Resolvable)?
    sageMakerImageArn: (String(matches(Regex(#"^arn:aws(-[\w]+)*:sagemaker:.+:[0-9]{12}:image/[a-z0-9]([-.]?[a-z0-9])*$"#)))|formae.Resolvable)?
    sageMakerImageVersionArn: (String(matches(Regex(#"^arn:aws(-[\w]+)*:sagemaker:.+:[0-9]{12}:image-version/[a-z0-9]([-.]?[a-z0-9])*/[0-9]+$"#)))|formae.Resolvable)?
}

@aws.SubResourceHint
open class SharingSettings extends formae.SubResource {
    notebookOutputOption: SharingSettingsNotebookOutputOption?
    s3KmsKeyId: (String(matches(Regex(#".*"#)))|formae.Resolvable)?
    s3OutputPath: (String(matches(Regex(#"^(https|s3)://([^/]+)/?(.*)$"#))))?
}

@aws.SubResourceHint
open class StudioWebPortalSettings extends formae.SubResource {
    hiddenAppTypes: Listing<String>?
    hiddenMlTools: Listing<String>?
}

@aws.SubResourceHint
open class UserSettings extends formae.SubResource {
    codeEditorAppSettings: CodeEditorAppSettings?
    customFileSystemConfigs: Listing<CustomFileSystemConfig>?
    customPosixUserConfig: CustomPosixUserConfig?
    defaultLandingUri: String?
    executionRole: (String(matches(Regex(#"^arn:aws[a-z\-]*:iam::\d{12}:role/?[a-zA-Z_0-9+=,.@\-_/]+$"#)))|formae.Resolvable)?
    jupyterLabAppSettings: JupyterLabAppSettings?
    jupyterServerAppSettings: JupyterServerAppSettings?
    kernelGatewayAppSettings: KernelGatewayAppSettings?
    rStudioServerProAppSettings: RStudioServerProAppSettings?
    securityGroups: Listing<String|formae.Resolvable>?
    sharingSettings: SharingSettings?
    spaceStorageSettings: DefaultSpaceStorageSettings?
    studioWebPortal: UserSettingsStudioWebPortal?
    studioWebPortalSettings: StudioWebPortalSettings?
    autoMountHomeEFS: AutoMountHomeEFS?
}

open class UserProfileResolvable extends formae.Resolvable {
    hidden type = module.type

    hidden userProfileArn: UserProfileResolvable = (this) {
        property = "UserProfileArn"
    }

    hidden userProfileName: UserProfileResolvable = (this) {
        property = "UserProfileName"
    }
}

@aws.ResourceHint {
    type = module.type
    identifier = "Ref"
}
open class UserProfile extends formae.Resource {

    @aws.FieldHint{createOnly = true}
    domainId: String|formae.Resolvable

    @aws.FieldHint{createOnly = true}
    singleSignOnUserIdentifier: (String(matches(Regex(#"UserName"#))))?

    @aws.FieldHint{createOnly = true}
    singleSignOnUserValue: String?

    @aws.FieldHint {
        writeOnly = true
        updateMethod = "EntitySet"
        indexField = "Key"
    }
    tags: Listing<aws.Tag>?

    @aws.FieldHint{createOnly = true}
    userProfileName: String

    @aws.FieldHint
    userSettings: UserSettings?

    hidden parent = this

    hidden res: UserProfileResolvable = new {
        label = parent.label
        stack = parent.stack?.label
    }
}