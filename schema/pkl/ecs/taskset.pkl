/*
 * Â© 2025 Platform Engineering Labs Inc.
 *
 * SPDX-License-Identifier: FSL-1.1-ALv2
 */

module aws.ecs.taskset

import "@formae/formae.pkl"
import "../aws.pkl"

const type = "AWS::ECS::TaskSet"

typealias AssignPublicIp = "DISABLED"|"ENABLED"

@aws.SubResourceHint
open class AWSVpcConfiguration extends formae.SubResource {
    assignPublicIp: AssignPublicIp?
    securityGroups: Listing<String>?
    subnets: Listing<String>
}

@aws.SubResourceHint
open class CapacityProviderStrategy extends formae.SubResource {
    base: Int?
    capacityProvider: String?
    weight: Int?
}

@aws.SubResourceHint
open class LoadBalancer extends formae.SubResource {
    containerName: String?
    containerPort: Int?
    targetGroupArn: String?
}

@aws.SubResourceHint
open class NetworkConfiguration extends formae.SubResource {
    awsVpcConfiguration: AWSVpcConfiguration?
}

typealias ScaleUnit = "PERCENT"

@aws.SubResourceHint
open class Scale extends formae.SubResource {
    unit: ScaleUnit?
    value: Number?
}

@aws.SubResourceHint
open class ServiceRegistry extends formae.SubResource {
    containerName: String?
    containerPort: Int?
    port: Int?
    registryArn: String?
}
@aws.ResourceHint {
    type = module.type
    identifier = "Cluster"
    discoverable = true
    parent = "AWS::ECS::Service"
    listParam = List ( new formae.ListProperty { parentProperty = "ServiceName" listParameter = "Service" }, new formae.ListProperty { parentProperty = "Cluster" listParameter = "Cluster" } )
}
open class TaskSet extends formae.Resource {

    @aws.FieldHint{createOnly = true}
    capacityProviderStrategy: Listing<CapacityProviderStrategy>?

    @aws.FieldHint{createOnly = true}
    cluster: String

    @aws.FieldHint{createOnly = true}
    externalId: String?

    @aws.FieldHint{createOnly = true}
    launchType: LaunchType?

    @aws.FieldHint{createOnly = true}
    loadBalancers: Listing<LoadBalancer>?

    @aws.FieldHint{createOnly = true}
    networkConfiguration: NetworkConfiguration?

    @aws.FieldHint{createOnly = true}
    platformVersion: String?

    @aws.FieldHint
    scale: Scale?

    @aws.FieldHint{createOnly = true}
    service: String

    @aws.FieldHint{createOnly = true}
    serviceRegistries: Listing<ServiceRegistry>?

    @aws.FieldHint
    tags: Listing<formae.Resolvable>?

    @aws.FieldHint{createOnly = true}
    taskDefinition: String
}

typealias LaunchType = "EC2"|"FARGATE"
