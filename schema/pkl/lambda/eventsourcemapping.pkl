/*
 * Â© 2025 Platform Engineering Labs Inc.
 *
 * SPDX-License-Identifier: FSL-1.1-ALv2
 */

module aws.lambda.eventsourcemapping

import "@formae/formae.pkl"
import "../aws.pkl"

const type = "AWS::Lambda::EventSourceMapping"

typealias FunctionResponseTypes = "ReportBatchItemFailures"

@aws.SubResourceHint
open class AmazonManagedKafkaEventSourceConfig extends formae.SubResource {
    consumerGroupId: String?
}

@aws.SubResourceHint
open class DestinationConfig extends formae.SubResource {
    onFailure: OnFailure?
}

typealias DocumentDBEventSourceConfigFullDocument = "UpdateLookup"|"Default"


@aws.SubResourceHint
open class DocumentDBEventSourceConfig extends formae.SubResource {
    collectionName: String?
    databaseName: String?
    fullDocument: DocumentDBEventSourceConfigFullDocument?
}


@aws.SubResourceHint
open class Endpoints extends formae.SubResource {
    kafkaBootstrapServers: Listing<String>?
}


@aws.SubResourceHint
open class Filter extends formae.SubResource {
    pattern: String(matches(Regex(#".*"#)))?
}


@aws.SubResourceHint
open class FilterCriteria extends formae.SubResource {
    filters: Listing<Filter>?
}

typealias MetricsConfigMetrics = "EventCount"


@aws.SubResourceHint
open class MetricsConfig extends formae.SubResource {
    metrics: Listing<MetricsConfigMetrics>?
}

@aws.SubResourceHint
open class OnFailure extends formae.SubResource {
    destination: (String(matches(Regex(#"arn:(aws[a-zA-Z0-9-]*):([a-zA-Z0-9\-])+:([a-z]{2}(-gov)?(-iso([a-z])?)?-[a-z]+-\d{1})?:(\d{12})?:(.*)"#)))|formae.Resolvable)?
}

@aws.SubResourceHint
open class ProvisionedPollerConfig extends formae.SubResource {
    maximumPollers: Int?
    minimumPollers: Int?
}


@aws.SubResourceHint
open class ScalingConfig extends formae.SubResource {
    maximumConcurrency: Int?
}


@aws.SubResourceHint
open class SelfManagedEventSource extends formae.SubResource {
    endpoints: Endpoints?
}


@aws.SubResourceHint
open class SelfManagedKafkaEventSourceConfig extends formae.SubResource {
    consumerGroupId: String
}

typealias SourceAccessConfigurationType = "BASIC_AUTH"|"VPC_SUBNET"|"VPC_SECURITY_GROUP"|"SASL_SCRAM_512_AUTH"|"SASL_SCRAM_256_AUTH"|"VIRTUAL_HOST"|"CLIENT_CERTIFICATE_TLS_AUTH"|"SERVER_ROOT_CA_CERTIFICATE"


@aws.SubResourceHint
open class SourceAccessConfiguration extends formae.SubResource {
    type: SourceAccessConfigurationType?
    uRI: (String(matches(Regex(#"[a-zA-Z0-9-\/*:_+=.@-]*"#)))|formae.Resolvable)?
}


@aws.ResourceHint {
    type = module.type
    identifier = "Id"
}
open class EventSourceMapping extends formae.Resource {

    @aws.FieldHint
    amazonManagedKafkaEventSourceConfig: AmazonManagedKafkaEventSourceConfig?

    @aws.FieldHint
    batchSize: Int?

    @aws.FieldHint
    bisectBatchOnFunctionError: Boolean?

    @aws.FieldHint
    destinationConfig: DestinationConfig?

    @aws.FieldHint
    documentDBEventSourceConfig: DocumentDBEventSourceConfig?

    @aws.FieldHint
    enabled: Boolean?

    @aws.FieldHint{createOnly = true}
    eventSourceArn: (String(matches(Regex(#"arn:(aws[a-zA-Z0-9-]*):([a-zA-Z0-9\-])+:([a-z]{2}(-gov)?(-iso([a-z])?)?-[a-z]+-\d{1})?:(\d{12})?:(.*)"#)))|formae.Resolvable)?

    @aws.FieldHint
    filterCriteria: FilterCriteria?

    @aws.FieldHint{createOnly = true}
    functionName: String(matches(Regex(#"(arn:(aws[a-zA-Z-]*)?:lambda:)?([a-z]{2}(-gov)?(-iso([a-z])?)?-[a-z]+-\d{1}:)?(\d{12}:)?(function:)?([a-zA-Z0-9-_]+)(:(\$LATEST|[a-zA-Z0-9-_]+))?"#)))|formae.Resolvable

    @aws.FieldHint
    functionResponseTypes: Listing<FunctionResponseTypes>?

    @aws.FieldHint
    kmsKeyArn: (String(matches(Regex(#"(arn:(aws[a-zA-Z-]*)?:[a-z0-9-.]+:.*)|()"#)))|formae.Resolvable)?

    @aws.FieldHint
    maximumBatchingWindowInSeconds: Int?

    @aws.FieldHint
    maximumRecordAgeInSeconds: Int?

    @aws.FieldHint
    maximumRetryAttempts: Int?

    @aws.FieldHint
    metricsConfig: MetricsConfig?

    @aws.FieldHint
    parallelizationFactor: Int?

    @aws.FieldHint
    provisionedPollerConfig: ProvisionedPollerConfig?

    @aws.FieldHint
    queues: Listing<String>?

    @aws.FieldHint
    scalingConfig: ScalingConfig?

    @aws.FieldHint{createOnly = true}
    selfManagedEventSource: SelfManagedEventSource?

    @aws.FieldHint
    selfManagedKafkaEventSourceConfig: SelfManagedKafkaEventSourceConfig?

    @aws.FieldHint
    sourceAccessConfigurations: Listing<SourceAccessConfiguration>?

    @aws.FieldHint{createOnly = true}
    startingPosition: (String(matches(Regex(#"(LATEST|TRIM_HORIZON|AT_TIMESTAMP)+"#))))?

    @aws.FieldHint{createOnly = true}
    startingPositionTimestamp: Number?

    @aws.FieldHint {
        updateMethod = "EntitySet"
        indexField = "Key"
    }
    tags: Listing<aws.Tag>?

    @aws.FieldHint{createOnly = true}
    topics: Listing<String>?

    @aws.FieldHint
    tumblingWindowInSeconds: Int?
}