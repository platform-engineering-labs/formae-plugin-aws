/*
 * Â© 2025 Platform Engineering Labs Inc.
 *
 * SPDX-License-Identifier: FSL-1.1-ALv2
 */

module aws.s3.bucket

import "../aws.pkl"
import "@formae/formae.pkl"

const type = "AWS::S3::Bucket"

@aws.SubResourceHint
open class AbortIncompleteMultipartUpload extends formae.SubResource {
    daysAfterInitiation: Int
}

typealias AccelerationStatus = "Enabled"|"Suspended"

@aws.SubResourceHint
open class AccelerateConfiguration extends formae.SubResource {
    accelerationStatus: AccelerationStatus
}

@aws.SubResourceHint
open class AccessControlTranslation extends formae.SubResource {
    owner: String
}

@aws.SubResourceHint
open class AnalyticsConfiguration extends formae.SubResource {
    id: String

    prefix: String?

    storageClassAnalysis: StorageClassAnalysis

    @aws.FieldHint {
        outputTransformation = formae.transform.capitalizeMemberKeys
    }
    tagFilters: Listing<aws.Tag>?
}

@aws.SubResourceHint
open class BucketEncryption extends formae.SubResource {
    serverSideEncryptionConfiguration: Listing<ServerSideEncryptionRule>
}

@aws.SubResourceHint
open class CorsConfiguration extends formae.SubResource {
    corsRules: Listing<CorsRule>
}

typealias AllowedMethods = "GET"|"PUT"|"HEAD"|"POST"|"DELETE"

@aws.SubResourceHint
open class CorsRule extends formae.SubResource {
    allowedHeaders: Listing<String>?

    allowedMethods: Listing<AllowedMethods>

    allowedOrigins: Listing<String>

    exposedHeaders: Listing<String>?

    id: String?

    maxAge: Int?
}

@aws.SubResourceHint
open class DataExport extends formae.SubResource {
    destination: Destination

    outputSchemaVersion: String
}

typealias DefaultRetentionMode = "COMPLIANCE"|"GOVERNANCE"

@aws.SubResourceHint
open class DefaultRetention extends formae.SubResource {
    days: Int?

    mode: DefaultRetentionMode?

    years: Int?
}

typealias DeleteMarkerReplicationStatus = "Disabled"|"Enabled"

@aws.SubResourceHint
open class DeleteMarkerReplication extends formae.SubResource {
    status: DeleteMarkerReplicationStatus?
}

typealias DestinationFormat = "CSV"|"ORC"|"Parquet"

@aws.SubResourceHint
open class Destination extends formae.SubResource {
    bucketAccountId: String?

    bucketArn: String|formae.Resolvable

    format: DestinationFormat

    prefix: String?
}

@aws.SubResourceHint
open class EncryptionConfiguration extends formae.SubResource {
    replicaKmsKeyID: String
}

@aws.SubResourceHint
open class EventBridgeConfiguration extends formae.SubResource {
    eventBridgeEnabled: Boolean
}

@aws.SubResourceHint
open class FilterRule extends formae.SubResource {
    name: String

    value: String
}

typealias IntelligentTieringConfigurationStatus = "Disabled"|"Enabled"

@aws.SubResourceHint
open class IntelligentTieringConfiguration extends formae.SubResource {
    id: String

    prefix: String?

    status: IntelligentTieringConfigurationStatus

    @aws.FieldHint {
        outputTransformation = formae.transform.capitalizeMemberKeys
    }
    tagFilters: Listing<aws.Tag>?

    tierings: Listing<Tiering>
}

typealias InventoryConfigurationIncludedObjectVersions = "All"|"Current"

typealias InventoryConfigurationOptionalFields = "Size"|"LastModifiedDate"|"StorageClass"|"ETag"|"IsMultipartUploaded"|"ReplicationStatus"|"EncryptionStatus"|"ObjectLockRetainUntilDate"|"ObjectLockMode"|"ObjectLockLegalHoldStatus"|"IntelligentTieringAccessTier"|"BucketKeyStatus"|"ChecksumAlgorithm"|"ObjectAccessControlList"|"ObjectOwner"

typealias InventoryConfigurationScheduleFrequency = "Daily"|"Weekly"

@aws.SubResourceHint
open class InventoryConfiguration extends formae.SubResource {
    destination: Destination

    enabled: Boolean

    id: String

    includedObjectVersions: InventoryConfigurationIncludedObjectVersions

    optionalFields: Listing<InventoryConfigurationOptionalFields>?

    prefix: String?

    scheduleFrequency: InventoryConfigurationScheduleFrequency
}

@aws.SubResourceHint
open class LambdaConfiguration extends formae.SubResource {
    event: String

    filter: NotificationFilter?

    `function`: String
}

typealias TransitionDefaultMinimumObjectSize = "varies_by_storage_class"|"all_storage_classes_128K"

@aws.SubResourceHint
open class LifecycleConfiguration extends formae.SubResource {
    rules: Listing<Rule>

    transitionDefaultMinimumObjectSize: TransitionDefaultMinimumObjectSize?
}

@aws.SubResourceHint
open class LoggingConfiguration extends formae.SubResource {
    destinationBucketName: String?

    logFilePrefix: String?

    targetObjectKeyFormat: Dynamic?
}

typealias MetricsStatus = "Disabled"|"Enabled"

@aws.SubResourceHint
open class Metrics extends formae.SubResource {
    eventThreshold: ReplicationTimeValue?

    status: MetricsStatus
}

@aws.SubResourceHint
open class MetricsConfiguration extends formae.SubResource {
    accessPointArn: String?

    id: String

    prefix: String?

    tagFilters: Listing<aws.Tag>?
}

@aws.SubResourceHint
open class NoncurrentVersionExpiration extends formae.SubResource {
    newerNoncurrentVersions: Int?

    noncurrentDays: Int
}

typealias NoncurrentVersionTransitionStorageClass = "DEEP_ARCHIVE"|"GLACIER"|"Glacier"|"GLACIER_IR"|"INTELLIGENT_TIERING"|"ONEZONE_IA"|"STANDARD_IA"

@aws.SubResourceHint
open class NoncurrentVersionTransition extends formae.SubResource {
    newerNoncurrentVersions: Int?

    storageClass: NoncurrentVersionTransitionStorageClass

    transitionInDays: Int
}

@aws.SubResourceHint
open class NotificationConfiguration extends formae.SubResource {
    eventBridgeConfiguration: EventBridgeConfiguration?

    lambdaConfigurations: Listing<LambdaConfiguration>?

    queueConfigurations: Listing<QueueConfiguration>?

    topicConfigurations: Listing<TopicConfiguration>?
}

@aws.SubResourceHint
open class NotificationFilter extends formae.SubResource {
    s3Key: S3KeyFilter
}

@aws.SubResourceHint
open class ObjectLockConfiguration extends formae.SubResource {
    objectLockEnabled: String?

    rule: ObjectLockRule?
}

@aws.SubResourceHint
open class ObjectLockRule extends formae.SubResource {
    defaultRetention: DefaultRetention?
}

@aws.SubResourceHint
open class OwnershipControls extends formae.SubResource {
    rules: Listing<OwnershipControlsRule>
}

typealias OwnershipControlsRuleObjectOwnership = "ObjectWriter"|"BucketOwnerPreferred"|"BucketOwnerEnforced"

@aws.SubResourceHint
open class OwnershipControlsRule extends formae.SubResource {
    objectOwnership: OwnershipControlsRuleObjectOwnership?
}

@aws.SubResourceHint
open class PublicAccessBlockConfiguration extends formae.SubResource {
    blockPublicAcls: Boolean?

    blockPublicPolicy: Boolean?

    ignorePublicAcls: Boolean?

    restrictPublicBuckets: Boolean?
}

@aws.SubResourceHint
open class QueueConfiguration extends formae.SubResource {
    event: String

    filter: NotificationFilter?

    queue: String
}

typealias RedirectAllRequestsToProtocol = "http"|"https"

@aws.SubResourceHint
open class RedirectAllRequestsTo extends formae.SubResource {
    hostName: String

    protocol: RedirectAllRequestsToProtocol?
}

typealias RedirectRuleProtocol = "http"|"https"

@aws.SubResourceHint
open class RedirectRule extends formae.SubResource {
    hostName: String?

    httpRedirectCode: String?

    protocol: RedirectRuleProtocol?

    replaceKeyPrefixWith: String?

    replaceKeyWith: String?
}

typealias ReplicaModificationsStatus = "Enabled"|"Disabled"

@aws.SubResourceHint
open class ReplicaModifications extends formae.SubResource {
    status: ReplicaModificationsStatus
}

@aws.SubResourceHint
open class ReplicationConfiguration extends formae.SubResource {
    role: String

    rules: Listing<ReplicationRule>
}

typealias ReplicationDestinationStorageClass = "DEEP_ARCHIVE"|"GLACIER"|"GLACIER_IR"|"INTELLIGENT_TIERING"|"ONEZONE_IA"|"REDUCED_REDUNDANCY"|"STANDARD"|"STANDARD_IA"

@aws.SubResourceHint
open class ReplicationDestination extends formae.SubResource {
    accessControlTranslation: AccessControlTranslation?

    account: String?

    bucket: String

    encryptionConfiguration: EncryptionConfiguration?

    metrics: Metrics?

    replicationTime: ReplicationTime?

    storageClass: ReplicationDestinationStorageClass?
}

typealias ReplicationRuleStatus = "Disabled"|"Enabled"

@aws.SubResourceHint
open class ReplicationRule extends formae.SubResource {
    deleteMarkerReplication: DeleteMarkerReplication?

    destination: ReplicationDestination

    filter: ReplicationRuleFilter?

    id: String?

    prefix: String?

    priority: Int?

    sourceSelectionCriteria: SourceSelectionCriteria?

    status: ReplicationRuleStatus
}

@aws.SubResourceHint
open class ReplicationRuleAndOperator extends formae.SubResource {
    prefix: String?

    tagFilters: Listing<aws.Tag>?
}

@aws.SubResourceHint
open class ReplicationRuleFilter extends formae.SubResource {
    and: ReplicationRuleAndOperator?

    prefix: String?

    tagFilter: aws.Tag?
}

typealias ReplicationTimeStatus = "Disabled"|"Enabled"

@aws.SubResourceHint
open class ReplicationTime extends formae.SubResource {
    status: ReplicationTimeStatus

    time: ReplicationTimeValue
}

@aws.SubResourceHint
open class ReplicationTimeValue extends formae.SubResource {
    minutes: Int
}

@aws.SubResourceHint
open class RoutingRule extends formae.SubResource {
    redirectRule: RedirectRule

    routingRuleCondition: RoutingRuleCondition?
}

@aws.SubResourceHint
open class RoutingRuleCondition extends formae.SubResource {
    httpErrorCodeReturnedEquals: String?

    keyPrefixEquals: String?
}

typealias RuleStatus = "Enabled"|"Disabled"

@aws.SubResourceHint
open class Rule extends formae.SubResource {
    abortIncompleteMultipartUpload: AbortIncompleteMultipartUpload?

    expirationDate: Bucketiso8601UTC?

    expirationInDays: Int?

    expiredObjectDeleteMarker: Boolean?

    id: String?

    noncurrentVersionExpiration: NoncurrentVersionExpiration?

    noncurrentVersionExpirationInDays: Int?

    @aws.FieldHint {
        writeOnly = true
    }
    noncurrentVersionTransition: NoncurrentVersionTransition?

    noncurrentVersionTransitions: Listing<NoncurrentVersionTransition>?

    objectSizeGreaterThan: String(matches(Regex(#"[0-9]+"#)))?

    objectSizeLessThan: String(matches(Regex(#"[0-9]+"#)))?

    @aws.FieldHint {
        writeOnly = true
    }
    prefix: String?

    status: RuleStatus

    tagFilters: Listing<aws.Tag>?

    transition: Transition?

    transitions: Listing<Transition>?
}

@aws.SubResourceHint
open class S3KeyFilter extends formae.SubResource {
    rules: Listing<FilterRule>
}

typealias ServerSideEncryptionByDefaultSSEAlgorithm = "aws:kms"|"AES256"|"aws:kms:dsse"

@aws.SubResourceHint
open class ServerSideEncryptionByDefault extends formae.SubResource {
    @aws.FieldHint {
        outputField = "KMSMasterKeyID"
    }
    kmsMasterKeyID: (String|formae.Resolvable)?

    @aws.FieldHint {
        outputField = "SSEAlgorithm"
    }
    sseAlgorithm: ServerSideEncryptionByDefaultSSEAlgorithm
}

@aws.SubResourceHint
open class ServerSideEncryptionRule extends formae.SubResource {
    bucketKeyEnabled: Boolean?

    serverSideEncryptionByDefault: ServerSideEncryptionByDefault?
}

@aws.SubResourceHint
open class SourceSelectionCriteria extends formae.SubResource {
    replicaModifications: ReplicaModifications?

    sseKmsEncryptedObjects: SseKmsEncryptedObjects?
}

typealias SseKmsEncryptedObjectsStatus = "Disabled"|"Enabled"

@aws.SubResourceHint
open class SseKmsEncryptedObjects extends formae.SubResource {
    status: SseKmsEncryptedObjectsStatus
}

@aws.SubResourceHint
open class StorageClassAnalysis extends formae.SubResource {
    dataExport: DataExport?
}

typealias TieringAccessTier = "ARCHIVE_ACCESS"|"DEEP_ARCHIVE_ACCESS"

@aws.SubResourceHint
open class Tiering extends formae.SubResource {
    accessTier: TieringAccessTier

    days: Int
}

@aws.SubResourceHint
open class TopicConfiguration extends formae.SubResource {
    event: String

    filter: NotificationFilter?

    topic: String
}

typealias TransitionStorageClass = "DEEP_ARCHIVE"|"GLACIER"|"Glacier"|"GLACIER_IR"|"INTELLIGENT_TIERING"|"ONEZONE_IA"|"STANDARD_IA"

@aws.SubResourceHint
open class Transition extends formae.SubResource {
    storageClass: TransitionStorageClass

    transitionDate: Bucketiso8601UTC?

    transitionInDays: Int?
}

typealias VersioningConfigurationStatus = "Enabled"|"Suspended"

@aws.SubResourceHint
open class VersioningConfiguration extends formae.SubResource {
    status: VersioningConfigurationStatus
}

@aws.SubResourceHint
open class WebsiteConfiguration extends formae.SubResource {
    errorDocument: String?

    indexDocument: String?

    redirectAllRequestsTo: RedirectAllRequestsTo?

    routingRules: Listing<RoutingRule>?
}

typealias Bucketiso8601UTC = String


open class BucketResolvable extends formae.Resolvable {
    hidden type = module.type

    hidden arn: BucketResolvable = (this) {
        property = "Arn"
    }

    hidden domainName: BucketResolvable = (this) {
        property = "DomainName"
    }

    hidden dualStackDomainName: BucketResolvable = (this) {
        property = "DualStackDomainName"
    }

    hidden metadataTableArn: BucketResolvable = (this) {
        property = "MetadataTableConfiguration.S3TablesDestination.TableArn"
    }

    hidden metadataTableNamespace: BucketResolvable = (this) {
        property = "MetadataTableConfiguration.S3TablesDestination.TableNamespace"
    }

    hidden regionalDomainName: BucketResolvable = (this) {
        property = "RegionalDomainName"
    }

    hidden websiteURL: BucketResolvable = (this) {
        property = "WebsiteURL"
    }

    hidden bucketName: BucketResolvable = (this) {
        property = "BucketName"
    }
}

typealias AccessControl = "AuthenticatedRead"|"AwsExecRead"|"BucketOwnerFullControl"|"BucketOwnerRead"|"LogDeliveryWrite"|"Private"|"PublicRead"|"PublicReadWrite"

@aws.ResourceHint {
    type = module.type
    identifier = "BucketName"
}
open class Bucket extends formae.Resource {
    hidden parent = this

    @aws.FieldHint
    accelerateConfiguration: AccelerateConfiguration?

    @aws.FieldHint {
        writeOnly = true
    }
    accessControl: AccessControl?

    @aws.FieldHint
    analyticsConfigurations: Listing<AnalyticsConfiguration>?

    @aws.FieldHint
    bucketEncryption: BucketEncryption?

    @aws.FieldHint {
        createOnly = true
    }
    bucketName: String?

    @aws.FieldHint
    corsConfiguration: CorsConfiguration?

    @aws.FieldHint
    intelligentTieringConfigurations: Listing<IntelligentTieringConfiguration>?

    @aws.FieldHint
    inventoryConfigurations: Listing<InventoryConfiguration>?

    @aws.FieldHint
    lifecycleConfiguration: LifecycleConfiguration?

    @aws.FieldHint
    loggingConfiguration: LoggingConfiguration?

    @aws.FieldHint
    metricsConfigurations: Listing<MetricsConfiguration>?

    @aws.FieldHint
    notificationConfiguration: NotificationConfiguration?

    @aws.FieldHint
    objectLockConfiguration: ObjectLockConfiguration?

    @aws.FieldHint
    objectLockEnabled: Boolean?

    @aws.FieldHint
    ownershipControls: OwnershipControls?

    @aws.FieldHint
    publicAccessBlockConfiguration: PublicAccessBlockConfiguration?

    @aws.FieldHint
    replicationConfiguration: ReplicationConfiguration?

    @aws.FieldHint {
        outputTransformation = formae.transform.capitalizeMemberKeys
        updateMethod = "EntitySet"
        indexField = "Key"
    }
    tags: Listing<aws.Tag>?

    @aws.FieldHint
    versioningConfiguration: VersioningConfiguration?

    @aws.FieldHint
    websiteConfiguration: WebsiteConfiguration?

    hidden res: BucketResolvable = new {
        label = parent.label
        stack = parent.stack?.label
    }
}