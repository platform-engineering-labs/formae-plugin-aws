/*
 * Â© 2025 Platform Engineering Labs Inc.
 *
 * SPDX-License-Identifier: FSL-1.1-ALv2
 */

module aws.rds.dbproxytargetgroup

import "./dbcluster.pkl"
import "@formae/formae.pkl"
import "../aws.pkl"

const type = "AWS::RDS::DBProxyTargetGroup"

typealias TargetGroupName = "default"

@aws.SubResourceHint
open class ConnectionPoolConfigurationInfoFormat extends formae.SubResource {
    connectionBorrowTimeout: Int?
    initQuery: String?
    maxConnectionsPercent: Int?
    maxIdleConnectionsPercent: Int?
    sessionPinningFilters: Listing<String>?
}

open class DBProxyTargetGroupResolvable extends formae.Resolvable {
    type = module.type

    targetGroupArn: DBProxyTargetGroupResolvable = (this) {
        Property = "TargetGroupArn"
    }
}


@aws.ResourceHint {
    type = module.type
    identifier = "TargetGroupArn"
    parent = "AWS::RDS::DBProxy"
    listParam = new formae.ListProperty { parentProperty = "DBProxyName" listParameter = "DBProxyName" }
}
open class DBProxyTargetGroup extends formae.Resource {

    @aws.FieldHint
    connectionPoolConfigurationInfo: ConnectionPoolConfigurationInfoFormat?

    @aws.FieldHint
    dBClusterIdentifiers: (Listing<String|formae.Resolvable>)?

    @aws.FieldHint{
        outputField = "DBInstanceIdentifiers"
    }
    dbInstanceIdentifiers: (Listing<String|formae.Resolvable>)?


    @aws.FieldHint{
        createOnly = true
        outputField = "DBProxyName"
    }
    dbProxyName: String(matches(Regex(#"[A-z][0-z]*"#)))


    @aws.FieldHint{createOnly = true}
    targetGroupName: TargetGroupName

    hidden parent = this

    hidden res: dbcluster.DBClusterResolvable = new {
        label = parent.label
        stack = parent.stack?.label
    }
}