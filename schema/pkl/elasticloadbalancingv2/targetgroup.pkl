/*
 * Â© 2025 Platform Engineering Labs Inc.
 *
 * SPDX-License-Identifier: FSL-1.1-ALv2
 */

module aws.elasticloadbalancingv2.targetgroup

import "@formae/formae.pkl"
import "../aws.pkl"

const type = "AWS::ElasticLoadBalancingV2::TargetGroup"

@aws.SubResourceHint
open class Matcher extends formae.SubResource {
    grpcCode: String?
    httpCode: String?
}

@aws.SubResourceHint
open class TargetDescription extends formae.SubResource {
    availabilityZone: aws.AvailabilityZone?
    id: String
    port: Int?
}

@aws.SubResourceHint
open class TargetGroupAttribute extends formae.SubResource {
    key: String?
    value: String?
}

open class TargetGroupResolvable extends formae.Resolvable {
    hidden type = module.type

    hidden loadBalancerArns: TargetGroupResolvable = (this) {
        property = "LoadBalancerArns"
    }

    hidden targetGroupArn: TargetGroupResolvable = (this) {
        property = "TargetGroupArn"
    }

    hidden targetGroupFullName: TargetGroupResolvable = (this) {
        property = "TargetGroupFullName"
    }

    hidden targetGroupName: TargetGroupResolvable = (this) {
        property = "TargetGroupName"
    }
}

@aws.ResourceHint {
    type = module.type
    identifier = "TargetGroupArn"
}
open class TargetGroup extends formae.Resource {

    @aws.FieldHint
    healthCheckEnabled: Boolean?

    @aws.FieldHint
    healthCheckIntervalSeconds: Int?

    @aws.FieldHint
    healthCheckPath: String?

    @aws.FieldHint
    healthCheckPort: String?

    @aws.FieldHint
    healthCheckProtocol: String?

    @aws.FieldHint
    healthCheckTimeoutSeconds: Int?

    @aws.FieldHint
    healthyThresholdCount: Int?

    @aws.FieldHint{createOnly = true}
    ipAddressType: String?

    @aws.FieldHint
    matcher: Matcher?

    @aws.FieldHint{createOnly = true}
    name: String?

    @aws.FieldHint{createOnly = true}
    port: Int?

    @aws.FieldHint{createOnly = true}
    protocol: String?

    @aws.FieldHint{createOnly = true}
    protocolVersion: String?

    @aws.FieldHint {
        updateMethod = "EntitySet"
        indexField = "Key"
    }
    tags: Listing<aws.Tag>?

    @aws.FieldHint
    targetGroupAttributes: Listing<TargetGroupAttribute>?

    @aws.FieldHint{createOnly = true}
    targetType: String?

    @aws.FieldHint
    targets: Listing<TargetDescription>?

    @aws.FieldHint
    unhealthyThresholdCount: Int?

    @aws.FieldHint{createOnly = true}
    vpcId: (String|formae.Resolvable)?

    hidden parent = this

    hidden res: TargetGroupResolvable = new {
        label = parent.label
        stack = parent.stack?.label
    }
}
